<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>The Office App - Money Rain</title>
  <style>
    :root { --bg-color: #0f172a; --card-bg: #1e293b; --success: #22c55e; --accent: #fbbf24; }
    body {
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      background: var(--bg-color);
      color: white;
      margin: 0;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .container { padding: 20px; z-index: 100; width: 100%; box-sizing: border-box; }
    .card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.5);
      display: inline-block;
      width: 90%;
      max-width: 400px;
    }
    input {
      width: 80%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #334155;
      background: #0f172a;
      color: white;
      font-size: 16px;
    }
    button {
      width: 85%;
      padding: 15px;
      border-radius: 8px;
      border: none;
      background: var(--success);
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    #work-ui { display: none; }
    .progress-container {
      width: 85%;
      background: #334155;
      height: 25px;
      border-radius: 12.5px;
      margin: 15px auto;
      overflow: hidden;
      position: relative;
    }
    #progress-bar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #4ade80);
      transition: width 0.4s ease;
    }
    #live-money { font-size: 2.5rem; color: var(--accent); margin: 10px 0; }
    #bucket { font-size: 70px; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 50; }
    .money { position: absolute; font-size: 30px; z-index: 1; pointer-events: none; }

    /* Celebration overlay */
    #celebration {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      pointer-events: none;
      background: radial-gradient(circle at center, rgba(15,23,42,0.25), rgba(15,23,42,0.75));
    }
    #celebration .msg {
      background: rgba(30,41,59,0.95);
      border: 1px solid rgba(148,163,184,0.25);
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
      border-radius: 18px;
      padding: 18px 18px;
      width: min(420px, 92vw);
      text-align: center;
      transform: scale(0.9);
      animation: popIn 450ms ease forwards;
    }
    #celebration .msg h2 { margin: 0 0 8px 0; font-size: 1.3rem; }
    #celebration .msg p { margin: 0; color: #cbd5e1; font-size: 1rem; }
    @keyframes popIn { to { transform: scale(1); } }

    .confetti {
      position: fixed;
      top: 50%;
      font-size: 28px;
      z-index: 10000;
      pointer-events: none;
      will-change: transform, opacity;
    }
  </style>
</head>

<body>
  <div class="container" id="setup-ui">
    <div class="card">
      <h2 id="welcome-msg">ğŸ’° ÎšÎ±Î»Ï‰ÏƒÎ®ÏÎ¸ÎµÏ‚!</h2>
      <input type="text" id="username" placeholder="Î¤Î¿ ÏŒÎ½Î¿Î¼Î¬ ÏƒÎ¿Ï…" />
      <input type="number" id="salary" placeholder="ÎœÎ·Î½Î¹Î±Î¯Î¿Ï‚ ÎšÎ±Î¸Î±ÏÏŒÏ‚ ÎœÎ¹ÏƒÎ¸ÏŒÏ‚" />
      <p style="font-size: 0.8rem;">Î£Îµ Ï€Î¿Î¹Î± ÏÏÎ± Ï„Î¿Ï… 8ÏÏÎ¿Ï… ÎµÎ¯ÏƒÎ±Î¹;</p>
      <input type="range" id="start-hour" min="0" max="8" step="0.5" value="0" />
      <div id="hour-display">ÎÏÎ±: 0</div>
      <button onclick="startApp()">Î•ÎÎ‘Î¡ÎÎ—</button>
    </div>
  </div>

  <div class="container" id="work-ui">
    <h3 id="greeting"></h3>
    <div id="live-money">0.00â‚¬</div>
    <div class="progress-container">
      <div id="progress-bar"></div>
    </div>
    <div id="stats-info" style="font-size: 0.9rem; color: #94a3b8;"></div>
    <button onclick="location.reload()" style="background:#ef4444; margin-top:20px; width: auto; padding: 10px 20px;">
      Reset
    </button>
  </div>

  <div id="bucket">ğŸª£</div>

  <!-- Celebration overlay -->
  <div id="celebration">
    <div class="msg">
      <h2>ğŸŠ ÎœÏ€ÏÎ¬Î²Î¿!</h2>
      <p>Î’Î³Î®ÎºÎµÏ‚ Î¶Ï‰Î½Ï„Î±Î½ÏŒÏ‚/Î® ÎºÎ±Î¹ ÏƒÎ®Î¼ÎµÏÎ±. ğŸ»</p>
    </div>
  </div>

  <script>
    let salary, dailyTarget, hourlyRate, startTime;
    let totalWorkedSecondsAtStart = 0;
    let celebrationShown = false;

    document.getElementById('start-hour').oninput = function () {
      document.getElementById('hour-display').innerText = `ÎÏÎ±: ${this.value}`;
    };

    async function startApp() {
      const name = document.getElementById('username').value;
      salary = parseFloat(document.getElementById('salary').value);

      if (!name || !salary) return alert("Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÏŒÎ½Î¿Î¼Î± ÎºÎ±Î¹ Î¼Î¹ÏƒÎ¸ÏŒ!");

      // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î¼Î­ÏƒÏ‰ Flask
      await fetch('/save_user', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: name })
      });

      dailyTarget = salary / 22;
      hourlyRate = dailyTarget / 8;

      // "ÎšÎ»ÎµÎ¹Î´ÏÎ½Î¿Ï…Î¼Îµ" Ï„Î·Î½ ÏÏÎ± Î­Î½Î±ÏÎ¾Î·Ï‚ Î¼Îµ Ï„Î¿ ÏÎ¿Î»ÏŒÎ¹ Ï„Î¿Ï… ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚
      startTime = Date.now();
      totalWorkedSecondsAtStart = parseFloat(document.getElementById('start-hour').value) * 3600;

      document.getElementById('setup-ui').style.display = 'none';
      document.getElementById('work-ui').style.display = 'block';
      document.getElementById('greeting').innerText = `Î“ÎµÎ¹Î± ÏƒÎ¿Ï…, ${name}!`;

      setInterval(updateUI, 1000);
      setInterval(createMoney, 1000); // Î’ÏÎ¿Ï‡Î® ÎºÎ¬Î¸Îµ Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î¿
    }

    function updateUI() {
      // Î¥Ï€Î¿Î»Î¿Î³Î¯Î¶Î¿Ï…Î¼Îµ Ï€ÏŒÏƒÎ± Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î± Ï€Î­ÏÎ±ÏƒÎ±Î½ Î±Ï€ÏŒ Ï„Î¿ Ï€Î¬Ï„Î·Î¼Î± Ï„Î¿Ï… ÎºÎ¿Ï…Î¼Ï€Î¹Î¿Ï
      const secondsSinceStart = Math.floor((Date.now() - startTime) / 1000);
      const currentTotalSeconds = totalWorkedSecondsAtStart + secondsSinceStart;

      const progressPercent = (currentTotalSeconds / (8 * 3600)) * 100;
      const earnedSoFar = (currentTotalSeconds / 3600) * hourlyRate;

      document.getElementById('progress-bar').style.width = Math.min(progressPercent, 100) + '%';
      document.getElementById('live-money').innerText = earnedSoFar.toFixed(2) + 'â‚¬';
      document.getElementById('stats-info').innerText =
        `Î£Ï„ÏŒÏ‡Î¿Ï‚: ${dailyTarget.toFixed(2)}â‚¬ | ÎÏÎ±: ${(currentTotalSeconds / 3600).toFixed(2)}/8`;

      if (currentTotalSeconds >= 8 * 3600) {
        document.getElementById('live-money').innerText = dailyTarget.toFixed(2) + 'â‚¬';
        document.getElementById('stats-info').innerText = "Î¤Î¿ 8Ï‰ÏÎ¿ Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ! ğŸº";

        if (!celebrationShown) {
          celebrationShown = true;
          showCelebration();
        }
      }
    }

    function createMoney() {
      const el = document.createElement('div');
      el.className = 'money';
      el.innerText = ['ğŸ’¶', 'ğŸ’°', 'ğŸ’¸'][Math.floor(Math.random() * 3)];
      el.style.left = Math.random() * 80 + 10 + 'vw';
      el.style.top = '-50px';
      document.body.appendChild(el);

      el.animate(
        [{ transform: 'translateY(0)' }, { transform: `translateY(${window.innerHeight}px)` }],
        { duration: 2500 }
      );

      setTimeout(() => el.remove(), 2500);
    }

    function showCelebration() {
      const overlay = document.getElementById('celebration');
      overlay.style.display = 'flex';

      const emojis = ['ğŸ‰', 'ğŸ¥³', 'ğŸŠ', 'âœ¨', 'ğŸ¾', 'ğŸª©', 'ğŸ‘'];
      const burstCount = 36;

      for (let i = 0; i < burstCount; i++) {
        const el = document.createElement('div');
        el.className = 'confetti';
        el.innerText = emojis[Math.floor(Math.random() * emojis.length)];

        const startX = window.innerWidth / 2;
        const startY = window.innerHeight / 2;

        const dir = Math.random() < 0.5 ? -1 : 1;
        const vx = dir * (120 + Math.random() * 420);
        const vy = (-120 + Math.random() * 260);
        const rot = (Math.random() * 720 - 360);
        const dur = 900 + Math.random() * 700;

        el.style.left = startX + 'px';
        el.style.top = startY + 'px';
        document.body.appendChild(el);

        el.animate(
          [
            { transform: 'translate(-50%, -50%) translate(0px, 0px) rotate(0deg)', opacity: 1 },
            { transform: `translate(-50%, -50%) translate(${vx}px, ${vy}px) rotate(${rot}deg)`, opacity: 0 }
          ],
          { duration: dur, easing: 'cubic-bezier(.2,.9,.2,1)' }
        );

        setTimeout(() => el.remove(), dur);
      }

      // ÎšÎ»ÎµÎ¯Î½ÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï„Î¿Ï… Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ Î»Î¯Î³Î¿ (Î±Î½ Î¸ÎµÏ‚ Î½Î± Î¼ÎµÎ¯Î½ÎµÎ¹, ÏƒÎ²Î®ÏƒÎµ Î±Ï…Ï„ÏŒ)
      setTimeout(() => {
        overlay.style.display = 'none';
      }, 3000);
    }
  </script>
</body>
</html>
